<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test Nango OAuth - Google Sheets</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; background:#0f172a; color:#e5e7eb; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
    .card { background:#111827; padding:24px 28px; border-radius:18px; box-shadow:0 18px 40px rgba(15,23,42,0.7); max-width:440px; width:100%; border:1px solid #1f2937; }
    h1 { font-size:20px; margin:0 0 6px; color:#38bdf8; }
    p { font-size:14px; margin:4px 0 10px; color:#9ca3af; }
    code { background:#111827; padding:2px 6px; border-radius:6px; font-size:12px; color:#22c55e; }
    button { margin-top:14px; width:100%; padding:10px 14px; border-radius:10px; border:none; font-size:15px; font-weight:500; cursor:pointer; background:linear-gradient(90deg,#38bdf8,#22c55e); color:#020817; }
    button:hover { opacity:0.92; }
    .log { margin-top:10px; padding:8px; border-radius:8px; background:#020817; font-size:11px; max-height:150px; overflow:auto; border:1px solid #111827; }
    .ok { color:#22c55e; }
    .err { color:#f97316; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîó Test Nango Self-Hosted</h1>
    <p>
      H√¥te Nango: <code>https://connect.streamline-internal.com</code><br>
      Int√©gration: <code>google-sheet</code><br>
      Connection ID: <code>test-connection-id</code>
    </p>
    <p>
      Clique sur le bouton ci-dessous pour lancer le flow OAuth Google Sheets
      via ton Nango self-hosted.
    </p>
    <button id="btn">Connecter Google Sheets via Nango</button>
    <div class="log" id="log">Logs ici...</div>
  </div>

  <script type="module">
    import Nango from 'https://cdn.jsdelivr.net/npm/@nangohq/frontend@latest/+esm';

    const logEl = document.getElementById('log');
    const btn = document.getElementById('btn');

    function log(msg, type = '') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = msg;
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
    }

    const nango = new Nango({
      host: 'https://connect.streamline-internal.com',
      publicKey: 'bdf512d9-4bab-43d6-8443-92d971d966c7', // ta cl√© publique Nango
    });

    btn.addEventListener('click', async () => {
      log('‚û°Ô∏è D√©marrage du flow OAuth...', '');
      try {
        const result = await nango.auth('google-sheet', 'test-connection-id');
        log('‚úÖ Succ√®s: ' + JSON.stringify(result), 'ok');
        alert('Connexion r√©ussie ‚úÖ (cf. logs)');
      } catch (err) {
        console.error(err);
        log('‚ùå Erreur: ' + (err?.message || JSON.stringify(err)), 'err');
        if (err?.type === 'windowClosed') {
          log('‚ÑπÔ∏è Tu as ferm√© la fen√™tre avant la fin du process OAuth.', 'err');
        }
      }
    });

    log('üü¢ Page pr√™te. Clique sur "Connecter Google Sheets via Nango".');
  </script>
</body>
</html>
